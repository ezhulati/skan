---
import '../styles/global.css';
import LanguageSwitcher from '../components/LanguageSwitcher.astro';
import CookieConsent from '../components/CookieConsent.astro';
import { SEO } from 'astro-seo';
import Header from '@sofidevo/astro-dynamic-header/Header';
import type { MenuItemType } from '@sofidevo/astro-dynamic-header';

export interface Props {
  title: string;
  description?: string;
  ogTitle?: string;
  ogDescription?: string;
  ogImage?: string;
}

const { 
  title, 
  description = "Sistemi QR për restorantet shqiptare. Menu dixhitale, porosi të shpejta dhe operacione më efikase për bizneset tuaja.", 
  ogTitle = title,
  ogDescription = description,
  ogImage = "https://skan.al/skan-al.jpg"
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site);

// Menu items for the dynamic header
const menuItems: MenuItemType[] = [
  { link: '/features', text: 'Veçoritë' },
  { link: '/pricing', text: 'Çmimet' },
  { link: '/blog', text: 'Blog' },
  { link: '/contact', text: 'Kontakti' },
];
---

<!DOCTYPE html>
<html lang="sq" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="generator" content={Astro.generator} />
  
  <!-- SEO Meta Tags -->
  <SEO
    title={title}
    description={description}
    canonical={canonicalURL}
    charset="utf-8"
    openGraph={{
      basic: {
        title: ogTitle,
        type: "website",
        image: ogImage,
        url: canonicalURL
      },
      optional: {
        description: ogDescription,
        siteName: "SKAN.AL",
        locale: "sq_AL"
      },
      image: {
        width: 1200,
        height: 630,
        type: "image/jpeg",
        alt: ogTitle
      }
    }}
    twitter={{
      card: "summary_large_image",
      site: "@skan_al",
      creator: "@skan_al",
      title: ogTitle,
      description: ogDescription,
      image: ogImage,
      imageAlt: ogTitle
    }}
    extend={{
      meta: [
        { property: "fb:app_id", content: "skan_al_app" },
        { name: "robots", content: "index, follow" },
        { name: "author", content: "SKAN.AL Team" }
      ]
    }}
  />
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="manifest" href="/site.webmanifest" />
  <meta name="theme-color" content="#2563eb" />
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  
  <!-- JSON-LD Structured Data -->
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "SKAN.AL",
      "url": "https://skan.al",
      "logo": "https://skan.al/images/logo.png",
      "description": "QR Code Ordering System for Albanian Restaurants",
      "address": {
        "@type": "PostalAddress",
        "addressCountry": "AL"
      },
      "sameAs": [
        "https://order.skan.al",
        "https://admin.skan.al"
      ]
    }
  </script>

  <!-- Swup Transition Styles -->
  <style>
    /* Base transition classes */
    .transition-fade {
      transition: opacity 0.3s ease-in-out;
    }
    
    html.is-changing .transition-fade {
      opacity: 0;
    }
    
    /* Main content transitions */
    #swup {
      transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
    }
    
    html.is-animating #swup {
      opacity: 0;
      transform: translateY(15px);
    }
    
    /* Page-specific transitions */
    .page-hero {
      transition: opacity 0.4s ease-out, transform 0.4s ease-out;
    }
    
    html.is-animating .page-hero {
      opacity: 0;
      transform: translateY(20px) scale(0.98);
    }
    
    /* Blog post transitions */
    .blog-content {
      transition: opacity 0.35s ease-in-out, transform 0.35s ease-in-out;
    }
    
    html.is-animating .blog-content {
      opacity: 0;
      transform: translateY(12px);
    }
    
    /* Card animations */
    .feature-card, .pricing-card, .blog-card {
      transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
    }
    
    html.is-animating .feature-card,
    html.is-animating .pricing-card,
    html.is-animating .blog-card {
      opacity: 0;
      transform: translateY(10px) scale(0.99);
    }
    
    /* Navigation smooth transitions */
    nav {
      transition: backdrop-filter 0.2s ease-in-out, background-color 0.2s ease-in-out;
    }
    
    /* Loading state */
    html.is-loading {
      cursor: wait;
    }
    
    html.is-loading * {
      pointer-events: none;
    }
    
    /* Smooth scroll enhancement */
    html {
      scroll-behavior: smooth;
    }
    
    /* Stagger animations for lists */
    .stagger-item {
      transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
      transition-delay: calc(var(--stagger-delay, 0) * 0.1s);
    }
    
    html.is-animating .stagger-item {
      opacity: 0;
      transform: translateY(8px);
    }

    /* Custom styles for dynamic header menu items */
    :global(.menu__link) {
      color: #374151 !important; /* Darker gray to match "Hyni" and "Demo" */
      font-weight: 500 !important;
    }

    :global(.menu__link:hover) {
      color: #111827 !important; /* Even darker on hover */
    }

    /* Mobile menu items */
    :global(.mobile-menu__link) {
      color: #374151 !important;
      font-weight: 500 !important;
    }

    :global(.mobile-menu__link:hover) {
      color: #111827 !important;
    }
  </style>
</head>

<body class="font-sans antialiased bg-white text-gray-900">
  <!-- Dynamic Header -->
  <Header
    headerType="floating"
    logoSrc="/favicon.svg"
    logoAlt="SKAN.AL"
    logoWidth="40px"
    homeUrl="/"
    menuItems={menuItems}
    backgroundColor="#ffffff90"
    backdropBlur="blur(20px)"
    zIndex={50}
  >
    <!-- Desktop header content -->
    <div slot="slot-desktop" class="hidden md:flex items-center space-x-4">
      <a href="https://admin.skan.al/login" class="text-gray-600 hover:text-gray-900 px-4 py-2 text-sm font-medium transition-colors whitespace-nowrap" data-sq="Hyni" data-en="Sign In">Hyni</a>
      <a href="/demo" class="text-gray-600 hover:text-gray-900 px-4 py-2 text-sm font-medium transition-colors whitespace-nowrap" data-sq="Demo" data-en="Demo">Demo</a>
      <LanguageSwitcher />
      <a href="/register" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap" data-sq="Filloni" data-en="Get Started">Filloni</a>
    </div>

    <!-- Mobile panel content -->
    <div slot="slot-panel" class="border-t border-gray-100 pt-4 mt-4">
      <div class="space-y-2">
        <a href="https://admin.skan.al/login" class="text-gray-600 hover:text-gray-900 block px-6 py-3 text-base font-medium whitespace-nowrap" data-sq="Hyni" data-en="Sign In">Hyni</a>
        <a href="/demo" class="text-gray-600 hover:text-gray-900 block px-6 py-3 text-base font-medium whitespace-nowrap" data-sq="Demo" data-en="Demo">Demo</a>
        <div class="px-6 py-3">
          <LanguageSwitcher />
        </div>
        <a href="/register" class="bg-blue-600 hover:bg-blue-700 text-white block px-6 py-3 rounded-lg text-base font-medium transition-colors mx-6 mt-4 text-center whitespace-nowrap" data-sq="Filloni" data-en="Get Started">Filloni</a>
      </div>
    </div>
  </Header>

  <!-- Main Content -->
  <main class="pt-16" id="swup">
    <slot />
  </main>

  <!-- Footer -->
  <footer class="bg-gray-50 border-t border-gray-200">
    <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-8">
        <!-- Logo and Description -->
        <div>
          <div class="flex items-center space-x-2 mb-4">
            <div class="w-8 h-8 bg-gradient-to-br from-blue-600 to-blue-700 rounded-lg flex items-center justify-center">
              <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 200 200">
                <path d="M75,15H35A20.06,20.06,0,0,0,15,35V75A20.06,20.06,0,0,0,35,95H75A20.06,20.06,0,0,0,95,75V35A20.06,20.06,0,0,0,75,15Zm0,60H35V35H75Zm0,30H35a20.06,20.06,0,0,0-20,20v40a20.06,20.06,0,0,0,20,20H75a20.06,20.06,0,0,0,20-20V125A20.06,20.06,0,0,0,75,105Zm0,60H35V125H75ZM165,15H125a20.06,20.06,0,0,0-20,20V75a20.06,20.06,0,0,0,20,20h40a20.06,20.06,0,0,0,20-20V35A20.06,20.06,0,0,0,165,15Zm0,60H125V35h40ZM50,65H60a5.38,5.38,0,0,0,5-5V50a5.38,5.38,0,0,0-5-5H50a5.38,5.38,0,0,0-5,5V60A5.38,5.38,0,0,0,50,65Zm0,90H60a5.38,5.38,0,0,0,5-5V140a5.38,5.38,0,0,0-5-5H50a5.38,5.38,0,0,0-5,5v10A5.38,5.38,0,0,0,50,155Zm90-90h10a5.38,5.38,0,0,0,5-5V50a5.38,5.38,0,0,0-5-5H140a5.38,5.38,0,0,0-5,5V60A5.38,5.38,0,0,0,140,65Zm-30,80h10a5.38,5.38,0,0,0,5-5V130a5.38,5.38,0,0,1,5-5h10a5.38,5.38,0,0,0,5-5V110a5.38,5.38,0,0,0-5-5H110a5.38,5.38,0,0,0-5,5v30a5.38,5.38,0,0,0,5,5Zm70-40H170a5.38,5.38,0,0,0-5,5v30a5.38,5.38,0,0,0,5,5h10a5.38,5.38,0,0,0,5-5V110A5.38,5.38,0,0,0,180,105Zm-60,60H110a5.38,5.38,0,0,0-5,5v10a5.38,5.38,0,0,0,5,5h10a5.38,5.38,0,0,0,5-5V170A5.38,5.38,0,0,0,120,165Zm60,0H170a5.38,5.38,0,0,1-5-5V150a5.38,5.38,0,0,0-5-5H130a5.38,5.38,0,0,0-5,5v10a5.38,5.38,0,0,0,5,5h10a5.38,5.38,0,0,1,5,5v10a5.38,5.38,0,0,0,5,5h30a5.38,5.38,0,0,0,5-5V170A5.38,5.38,0,0,0,180,165Z"/>
              </svg>
            </div>
            <span class="font-bold text-xl text-gray-900">SKAN</span>
          </div>
          <p class="text-gray-600 mb-4 max-w-md" data-sq="Sistem porosish me kod QR i krijuar për restorantet shqiptare. Thjeshtoni operacionet, reduktoni kohët e pritjes, dhe përmirësoni përvojën e klientëve." data-en="QR code ordering system designed for Albanian restaurants. Streamline operations, reduce wait times, and enhance customer experience.">
            Sistem porosish me kod QR i krijuar për restorantet shqiptare. Thjeshtoni operacionet, reduktoni kohët e pritjes, dhe përmirësoni përvojën e klientëve.
          </p>
          <div class="flex space-x-4">
            <a href="#" class="text-gray-400 hover:text-pink-500 transition-colors p-2">
              <span class="sr-only">Instagram</span>
              <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
              </svg>
            </a>
            <a href="#" class="text-gray-400 hover:text-blue-600 transition-colors p-2">
              <span class="sr-only">Facebook</span>
              <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
                <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
              </svg>
            </a>
          </div>
        </div>
        
        <!-- Navigation Links -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-8">
          <!-- Product Links -->
          <div>
            <h3 class="text-sm font-semibold text-gray-900 tracking-wider uppercase mb-4" data-sq="Produkti" data-en="Product">Produkti</h3>
            <ul class="space-y-2">
              <li><a href="/features" class="text-gray-600 hover:text-gray-900 py-2 inline-block" data-sq="Veçoritë" data-en="Features">Veçoritë</a></li>
              <li><a href="/pricing" class="text-gray-600 hover:text-gray-900 py-2 inline-block" data-sq="Çmimet" data-en="Pricing">Çmimet</a></li>
              <li><a href="/demo" class="text-gray-600 hover:text-gray-900 py-2 inline-block" data-sq="Demo" data-en="Demo">Demo</a></li>
              <li><a href="/integrations" class="text-gray-600 hover:text-gray-900 py-2 inline-block" data-sq="Integrime" data-en="Integrations">Integrime</a></li>
            </ul>
          </div>
          
          <!-- Support Links -->
          <div>
            <h3 class="text-sm font-semibold text-gray-900 tracking-wider uppercase mb-4" data-sq="Mbështetje" data-en="Support">Mbështetje</h3>
            <ul class="space-y-2">
              <li><a href="/help" class="text-gray-600 hover:text-gray-900 py-2 inline-block" data-sq="Qendra e Ndihmës" data-en="Help Center">Qendra e Ndihmës</a></li>
              <li><a href="/contact" class="text-gray-600 hover:text-gray-900 py-2 inline-block" data-sq="Kontakti" data-en="Contact">Kontakti</a></li>
              <li><a href="/blog" class="text-gray-600 hover:text-gray-900 py-2 inline-block" data-sq="Blog" data-en="Blog">Blog</a></li>
              <li><a href="/about" class="text-gray-600 hover:text-gray-900 py-2 inline-block" data-sq="Rreth nesh" data-en="About">Rreth nesh</a></li>
            </ul>
          </div>
        </div>
      </div>
      
      <div class="mt-8 pt-8 border-t border-gray-200">
        <div class="flex flex-col md:flex-row justify-between items-center">
          <p class="text-gray-500 text-sm" data-sq={`© ${new Date().getFullYear()} SKAN.AL. Të gjitha të drejtat e rezervuara.`} data-en={`© ${new Date().getFullYear()} SKAN.AL. All rights reserved.`}>
            © {new Date().getFullYear()} SKAN.AL. Të gjitha të drejtat e rezervuara.
          </p>
          <div class="mt-2 md:mt-0">
            <a href="/privacy" class="text-gray-500 hover:text-gray-900 text-sm mr-6 py-2 inline-block" data-sq="Politika e Privatësisë" data-en="Privacy Policy">Politika e Privatësisë</a>
            <a href="/terms" class="text-gray-500 hover:text-gray-900 text-sm py-2 inline-block" data-sq="Kushtet e Shërbimit" data-en="Terms of Service">Kushtet e Shërbimit</a>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <!-- Cookie Consent Banner -->
  <CookieConsent />

  <!-- Swup Page Transitions -->
  <script is:inline>
    import('swup').then(({ Swup }) => {
      const swup = new Swup({
        containers: ['#swup'],
        animateHistoryBrowsing: true,
        cache: true,
        preload: true,
        timeout: 5000,
        ignoreVisit: (url, { el }) => {
          // Ignore external links and certain file types
          return url.includes('admin.skan.al') || 
                 url.includes('order.skan.al') ||
                 el?.hasAttribute('data-no-swup') ||
                 url.match(/\.(pdf|zip|doc|docx)$/);
        },
        linkSelector: 'a[href]:not([data-no-swup]):not([href^="mailto:"]):not([href^="tel:"]):not([href^="https://admin"]):not([href^="https://order"]):not([href^="http://"]):not([target="_blank"])'
      });

      // Initialize functions
      function initializeDynamicHeader() {
        // Dynamic header component handles its own initialization
        // No additional setup needed
      }

      function initializeLanguageSwitcher() {
        // Re-initialize any language switching functionality
        const langElements = document.querySelectorAll('[data-sq]');
        // Language functionality will be handled by the LanguageSwitcher component
      }

      function initializeSmoothScroll() {
        // Enhance scroll behavior for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
          anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
              target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
              });
            }
          });
        });
      }

      // Initial setup
      initializeDynamicHeader();
      initializeLanguageSwitcher();
      initializeSmoothScroll();

      // Re-initialize after page transitions
      swup.hooks.on('content:replace', () => {
        initializeDynamicHeader();
        initializeLanguageSwitcher();
        initializeSmoothScroll();
        
        // Scroll to top for new pages
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });

      // Add loading states
      swup.hooks.on('visit:start', () => {
        document.documentElement.classList.add('is-loading');
      });

      swup.hooks.on('content:replace', () => {
        document.documentElement.classList.remove('is-loading');
      });

      // Handle failed requests
      swup.hooks.on('fetch:error', () => {
        document.documentElement.classList.remove('is-loading');
        console.warn('Swup: Failed to load page, falling back to regular navigation');
      });

      // Debug mode for development
      if (import.meta.env.DEV) {
        swup.hooks.on('visit:start', (visit) => {
          console.log('Swup: Navigating to', visit.to.url);
        });
        
        swup.hooks.on('content:replace', () => {
          console.log('Swup: Content replaced');
        });
      }
    }).catch(error => {
      console.warn('Swup failed to load, falling back to regular navigation:', error);
    });
  </script>
</body>
</html>